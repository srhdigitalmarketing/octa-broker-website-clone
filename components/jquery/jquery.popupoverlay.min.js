var $,scrollbarwidth,opentimer,mousedownTarget,$window,options,zindexvalues,lastclicked,bodymarginright,opensuffix,closesuffix,visiblePopupsArray,transitionsupport,iOS,methods,callback,isInViewport;$window=($=jQuery)(window),options={},zindexvalues=[],lastclicked=[],bodymarginright=null,opensuffix="_open",closesuffix="_close",visiblePopupsArray=[],transitionsupport=null,iOS=/(iPad|iPhone|iPod)/.test(navigator.userAgent),methods={_init:function(t){var o=$(t),e=o.data("popupoptions");lastclicked[t.id]=!1,zindexvalues[t.id]=0,o.data("popup-initialized")||(o.attr("data-popup-initialized","true"),methods._initonce(t)),e.autoopen&&setTimeout(function(){methods.show(t,0)},0)},_initonce:function(t){var o,e,i,n=$(t),s=$("body"),a=n.data("popupoptions");if(bodymarginright=parseInt(s.css("margin-right"),10),transitionsupport=void 0!==document.body.style.webkitTransition||void 0!==document.body.style.MozTransition||void 0!==document.body.style.msTransition||void 0!==document.body.style.OTransition||void 0!==document.body.style.transition,a.scrolllock&&void 0===scrollbarwidth&&(scrollbarwidth=(i=(e=$('<div style="width:50px;height:50px;overflow:auto"><div/></div>').appendTo("body")).children()).innerWidth()-i.height(99).innerWidth(),e.remove()),n.attr("id")||n.attr("id","j-popup-"+parseInt(1e8*Math.random(),10)),n.addClass("popup_content"),a.background&&!$("#"+t.id+"_background").length){s.append('<div id="'+t.id+'_background" class="popup_background"></div>');var p=$("#"+t.id+"_background");p.css({opacity:0,visibility:"hidden",backgroundColor:a.color,position:"fixed",top:0,right:0,bottom:0,left:0}),a.setzindex&&!a.autozindex&&p.css("z-index","100000"),a.transition&&p.css("transition",a.transition)}s.append(t),n.wrap('<div id="'+t.id+'_wrapper" class="popup_wrapper" />'),(o=$("#"+t.id+"_wrapper")).css({opacity:0,visibility:"hidden",position:"absolute"}),iOS&&((p=$("#"+t.id+"_background")).css("cursor","pointer"),$(a.pagecontainer).css("cursor","pointer")),"overlay"==a.type&&!a.absolute&&a.background&&(o.css("overflow","auto"),o[0].style.WebkitOverflowScrolling="touch"),n.css({opacity:0,visibility:"hidden","pointer-events":"auto",display:"inline-block"}),a.setzindex&&!a.autozindex&&o.css("z-index","100001"),a.outline||n.css("outline","none"),a.transition&&(n.css("transition",a.transition),o.css("transition",a.transition)),n.attr("aria-hidden",!0),"overlay"==a.type&&(n.css({textAlign:"left",position:"relative",verticalAlign:"middle"}),o.css({position:"fixed",width:"100%",height:"100%",top:0,left:0,textAlign:"center"}),o.append('<div class="popup_align" />'),$(".popup_align").css({display:"inline-block",verticalAlign:"middle",height:"100%"})),n.attr("role","dialog");var l=a.openelement?a.openelement:"."+t.id+opensuffix;$(l).each(function(t,o){$(o).attr("data-popup-ordinal",t),o.id||$(o).attr("id","open_"+parseInt(1e8*Math.random(),10))}),n.attr("aria-labelledby")||n.attr("aria-label")||n.attr("aria-labelledby",$(l).attr("id")),"hover"==a.action?(a.keepfocus=!1,$(l).on("mouseenter",function(){methods.show(t,$(this).data("popup-ordinal"))}),$(l).on("mouseleave",function(){methods.hide(t)})):$(document).on("click.jqp",l,function(o){o.preventDefault();var e=$(this).data("popup-ordinal");setTimeout(function(){methods.show(t,e)},0)}),a.closebutton&&methods.addclosebutton(t),a.detach?n.detach():n.hide()},show:function(t,o){var e=$(t);if(!e.data("popup-visible")){e.data("popup-initialized")||methods._init(t),e.attr("data-popup-initialized","true");var i=$("body"),n=e.data("popupoptions"),s=$("#"+t.id+"_wrapper"),a=$("#"+t.id+"_background");if(callback(t,o,n.beforeopen),lastclicked[t.id]=o,setTimeout(function(){visiblePopupsArray.push(t.id)},0),n.autozindex){for(var p=document.getElementsByTagName("*"),l=p.length,d=0,r=0;r<l;r++){var c=$(p[r]).css("z-index");"auto"!==c&&d<(c=parseInt(c,10))&&(d=c)}zindexvalues[t.id]=d,n.background&&zindexvalues[t.id]>=0&&$("#"+t.id+"_background").css({zIndex:zindexvalues[t.id]+1}),zindexvalues[t.id]>=0&&s.css({zIndex:zindexvalues[t.id]+2})}n.detach&&s.prepend(t),e.show(),opentimer=setTimeout(function(){s.css({visibility:"visible",opacity:1}),$("html").addClass("popup_visible").addClass("popup_visible_"+t.id),s.addClass("popup_wrapper_visible")},20),n.scrolllock&&(i.css("overflow","hidden"),i.height()>$window.height()&&i.css("margin-right",bodymarginright+scrollbarwidth)),e.css({visibility:"visible",opacity:1}),n.background&&(a.css({visibility:"visible",opacity:n.opacity}),setTimeout(function(){a.css({opacity:n.opacity})},0)),e.data("popup-visible",!0),methods.reposition(t,o),e.data("focusedelementbeforepopup",document.activeElement),e.attr("tabindex",-1),setTimeout(function(){"closebutton"===n.focuselement?$("#"+t.id+" ."+t.id+closesuffix+":first").focus():n.focuselement?$(n.focuselement).focus():(!0===n.focuselement||n.keepfocus)&&e.focus()},n.focusdelay),n.keepfocus&&$(n.pagecontainer).attr("aria-hidden",!0),e.attr("aria-hidden",!1),callback(t,o,n.onopen),transitionsupport?s.one("transitionend",function(){callback(t,o,n.opentransitionend)}):callback(t,o,n.opentransitionend),"tooltip"==n.type&&$(window).on("resize."+t.id,function(){methods.reposition(t,o)})}},hide:function(t,o){var e=$.inArray(t.id,visiblePopupsArray);if(-1!==e){opentimer&&clearTimeout(opentimer);var i=$("body"),n=$(t),s=n.data("popupoptions"),a=$("#"+t.id+"_wrapper"),p=$("#"+t.id+"_background");n.data("popup-visible",!1),1===visiblePopupsArray.length?$("html").removeClass("popup_visible").removeClass("popup_visible_"+t.id):$("html").hasClass("popup_visible_"+t.id)&&$("html").removeClass("popup_visible_"+t.id),visiblePopupsArray.splice(e,1),a.hasClass("popup_wrapper_visible")&&a.removeClass("popup_wrapper_visible"),s.keepfocus&&!o&&setTimeout(function(){$(n.data("focusedelementbeforepopup")).is(":visible")&&n.data("focusedelementbeforepopup").focus()},0),a.css({visibility:"hidden",opacity:0}),n.css({visibility:"hidden",opacity:0}),s.background&&p.css({visibility:"hidden",opacity:0}),$(s.pagecontainer).attr("aria-hidden",!1),n.attr("aria-hidden",!0),callback(t,lastclicked[t.id],s.onclose),transitionsupport&&"0s"!==n.css("transition-duration")?n.one("transitionend",function(){n.data("popup-visible")||(s.detach?n.detach():n.hide()),s.scrolllock&&setTimeout(function(){$.grep(visiblePopupsArray,function(t){return $("#"+t).data("popupoptions").scrolllock}).length||i.css({overflow:"visible","margin-right":bodymarginright})},10),callback(t,lastclicked[t.id],s.closetransitionend)}):(s.detach?n.detach():n.hide(),s.scrolllock&&setTimeout(function(){$.grep(visiblePopupsArray,function(t){return $("#"+t).data("popupoptions").scrolllock}).length||i.css({overflow:"visible","margin-right":bodymarginright})},10),callback(t,lastclicked[t.id],s.closetransitionend)),"tooltip"==s.type&&$(window).off("resize."+t.id)}},toggle:function(t,o){$(t).data("popup-visible")?methods.hide(t):setTimeout(function(){methods.show(t,o)},0)},reposition:function(t,o){var e=$(t),i=e.data("popupoptions"),n=$("#"+t.id+"_wrapper");if(o=o||0,"tooltip"==i.type){n.css({position:"absolute"});var s=i.tooltipanchor?$(i.tooltipanchor):i.openelement?$(i.openelement).filter('[data-popup-ordinal="'+o+'"]'):$("."+t.id+opensuffix+'[data-popup-ordinal="'+o+'"]'),a=s.offset()||{left:0,top:0};"right"==i.horizontal?n.css("left",a.left+s.outerWidth()+i.offsetleft):"leftedge"==i.horizontal?n.css("left",a.left+i.offsetleft):"left"==i.horizontal?n.css("right",$window.width()-a.left-i.offsetleft):"rightedge"==i.horizontal?n.css("right",$window.width()-a.left-s.outerWidth()-i.offsetleft):n.css("left",a.left+s.outerWidth()/2-e.outerWidth()/2-parseFloat(e.css("marginLeft"))+i.offsetleft),"bottom"==i.vertical?n.css("top",a.top+s.outerHeight()+i.offsettop):"bottomedge"==i.vertical?n.css("top",a.top+s.outerHeight()-e.outerHeight()+i.offsettop):"top"==i.vertical?n.css("bottom",$window.height()-a.top-i.offsettop):"topedge"==i.vertical?n.css("bottom",$window.height()-a.top-e.outerHeight()-i.offsettop):n.css("top",a.top+s.outerHeight()/2-e.outerHeight()/2-parseFloat(e.css("marginTop"))+i.offsettop)}else"overlay"==i.type&&(i.horizontal?n.css("text-align",i.horizontal):n.css("text-align","center"),i.vertical?e.css("vertical-align",i.vertical):e.css("vertical-align","middle"),i.absolute&&n.css({position:"absolute",top:window.scrollY}),!i.background&&(n.css({"pointer-events":"none"}),i.absolute||isInViewport(t)||(e.css("overflow","auto"),e[0].style.WebkitOverflowScrolling="touch",e.css("max-height","calc(100% - "+e.css("margin-top")+" - "+e.css("margin-bottom")+")"))))},addclosebutton:function(t){var o;o=$(t).data("popupoptions").closebuttonmarkup?$(options.closebuttonmarkup).addClass(t.id+"_close"):'<button class="popup_close '+t.id+'_close" title="Close" aria-label="Close"><span aria-hidden="true">Ã—</span></button>',$(t).data("popup-initialized")&&$(t).append(o)}},callback=function(t,o,e){var i,n=$(t).data("popupoptions");void 0!==n&&(i=$((n.openelement?n.openelement:"."+t.id+opensuffix)+'[data-popup-ordinal="'+o+'"]'),"function"==typeof e&&e.call($(t),t,i))},isInViewport=function(t){var o=t.getBoundingClientRect();return o.top>=0&&o.left>=0&&o.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&o.right<=(window.innerWidth||document.documentElement.clientWidth)},$(document).on("keydown",function(t){if(visiblePopupsArray.length){var o=visiblePopupsArray[visiblePopupsArray.length-1],e=document.getElementById(o);$(e).data("popupoptions").escape&&27==t.keyCode&&methods.hide(e)}}),$(document).on("mousedown",function(t){mousedownTarget=t.target}),$(document).on("click",function(t){if(visiblePopupsArray.length){var o=visiblePopupsArray[visiblePopupsArray.length-1],e=document.getElementById(o),i=$(e).data("popupoptions").closeelement?$(e).data("popupoptions").closeelement:"."+e.id+closesuffix;$(t.target).closest(i).length&&(t.preventDefault(),methods.hide(e)),$(e).data("popupoptions")&&$(e).data("popupoptions").blur&&!$(t.target).closest($(e).data("popupoptions").blurignore).length&&!$(t.target).closest("#"+o).length&&!$(mousedownTarget).closest("#"+o).length&&2!==t.which&&$(t.target).is(":visible")&&($(e).data("popupoptions").background?(methods.hide(e),t.preventDefault()):methods.hide(e,!0))}}),$(document).on("keydown",function(t){if(visiblePopupsArray.length&&9==t.which){var o=visiblePopupsArray[visiblePopupsArray.length-1],e=document.getElementById(o);if($(e).data("popupoptions").keepfocus){var i=$(e).find("*").filter("a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, object, embed, *[tabindex], *[contenteditable]").filter(":visible"),n=$(":focus"),s=i.length,a=i.index(n);0===s?($(e).focus(),t.preventDefault()):t.shiftKey?0===a&&(i.get(s-1).focus(),t.preventDefault()):a==s-1&&(i.get(0).focus(),t.preventDefault())}}}),$.fn.popup=function(t){return this.each(function(){var o=$(this),e=$.extend(!0,{},$.fn.popup.defaults);if(t&&"tooltip"===t.type&&(e.background=!1),"object"==typeof t){var i=$.extend({},e,o.data("popupoptions"),t);o.data("popupoptions",i),options=o.data("popupoptions"),methods._init(this)}else"string"==typeof t?(o.data("popupoptions")||(o.data("popupoptions",e),options=o.data("popupoptions")),methods[t].call(this,this)):(o.data("popupoptions")||(o.data("popupoptions",e),options=o.data("popupoptions")),methods._init(this))})},$.fn.popup.destroyall=function(){for(var t=0;t<visiblePopupsArray.length;t++)$("#"+visiblePopupsArray[t]).popup("hide");$(".popup_wrapper").remove(),$(".popup_background").remove(),$(document).off("click.jqp")},$.fn.popup.defaults={type:"overlay",absolute:!1,autoopen:!1,background:!0,color:"black",opacity:"0.5",horizontal:"center",vertical:"middle",offsettop:0,offsetleft:0,escape:!0,blur:!0,blurignore:null,setzindex:!0,autozindex:!1,scrolllock:!1,closebutton:!1,closebuttonmarkup:null,keepfocus:!0,focuselement:null,focusdelay:50,outline:!1,pagecontainer:null,detach:!1,openelement:null,closeelement:null,transition:null,tooltipanchor:null,beforeopen:null,onclose:null,onopen:null,opentransitionend:null,closetransitionend:null};