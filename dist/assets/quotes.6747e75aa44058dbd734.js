var EventManager=function(){var e;function t(){var e,n;if(!(this instanceof t))throw TypeError("Cannot call a class as a function");n={},(e="listeners")in this?Object.defineProperty(this,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):this[e]=n}return e=[{key:"addListener",value:function(e,t){this.listeners[e]=this.listeners[e]||[],this.listeners[e].push(t)}},{key:"removeListener",value:function(e,t){if(this.listeners[e]){var n=this.listeners[e].indexOf(t);-1!=n&&this.listeners[e].splice(n,1)}}},{key:"removeListeners",value:function(e){e?delete this.listeners[e]:this.listeners={}}},{key:"trigger",value:function(e,t){var n=!0,r=!1,i=void 0;try{for(var s,o=("*"==e?["*"]:["*",e])[Symbol.iterator]();!(n=(s=o.next()).done);n=!0){var a=s.value;if(this.listeners.hasOwnProperty(a)){var u=!0,l=!1,c=void 0;try{for(var y,h=this.listeners[a][Symbol.iterator]();!(u=(y=h.next()).done);u=!0)(0,y.value)(t)}catch(e){l=!0,c=e}finally{try{u||null==h.return||h.return()}finally{if(l)throw c}}}}}catch(e){r=!0,i=e}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}();function _define_property(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ConnectionStatus=((ConnectionStatus={})[ConnectionStatus.CLOSED=0]="CLOSED",ConnectionStatus[ConnectionStatus.PENDING=1]="PENDING",ConnectionStatus[ConnectionStatus.OPEN=2]="OPEN",ConnectionStatus[ConnectionStatus.ERROR=3]="ERROR",ConnectionStatus),Client=function(){var e;function t(e){var n=!(arguments.length>1)||void 0===arguments[1]||arguments[1];if(!(this instanceof t))throw TypeError("Cannot call a class as a function");_define_property(this,"url",void 0),_define_property(this,"listeners",{}),_define_property(this,"connectStatus",0),_define_property(this,"eventManager",new EventManager),_define_property(this,"ws",void 0),_define_property(this,"queue",[]),this.url=e,n&&this.connect()}return e=[{key:"connect",value:function(e){var t=this;if(e||0==this.connectStatus){var n=new WebSocket(this.url);this.connectStatus=1,n.onerror=function(e){throw Error(e.message)},n.onopen=function(){t.connectStatus=2;var e=t.queue.splice(0,t.queue.length),n=!0,r=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(n=(s=o.next()).done);n=!0){var a=s.value;t.send(a)}}catch(e){r=!0,i=e}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}},n.onclose=function(e){e.wasClean?t.connectStatus=0:t.connectStatus=3},n.onmessage=function(e){var n=t.parseMessage(e);t.eventManager.trigger(n.event,n.payload)},this.ws=n}}},{key:"isConnected",value:function(){return 2==this.connectStatus}},{key:"send",value:function(e){"string"!=typeof e&&(e=JSON.stringify(e)),this.isConnected()?this.ws.send(e):this.queue.push(e)}},{key:"parseMessage",value:function(e){var t;try{t=JSON.parse(e.data)}catch(e){}return t}},{key:"getEventManager",value:function(){return this.eventManager}},{key:"close",value:function(){this.ws&&this.ws.close()}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}();function quotes_define_property(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Quotes=function(){var e;function t(e){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:30;if(!(this instanceof t))throw TypeError("Cannot call a class as a function");quotes_define_property(this,"wsClient",void 0),quotes_define_property(this,"historyLimit",void 0),quotes_define_property(this,"history",{}),quotes_define_property(this,"eventManager",new EventManager),this.wsClient=e,this.historyLimit=r>0?r:1,e.getEventManager().addListener("quoteUpdate",function(e){n.pushHistory(e),n.getEventManager().trigger(e.symbolName,e)}),e.getEventManager().addListener("quoteHistory",function(e){var t=!0,r=!1,i=void 0;try{for(var s,o,a=e[Symbol.iterator]();!(t=(o=a.next()).done);t=!0)s=o.value,n.pushHistory(s)}catch(e){r=!0,i=e}finally{try{t||null==a.return||a.return()}finally{if(r)throw i}}s&&n.getEventManager().trigger(s.symbolName,s)})}return e=[{key:"getEventManager",value:function(){return this.eventManager}},{key:"prefetchData",value:function(e){this.history=e}},{key:"pushHistory",value:function(e){this.history[e.symbolName]=this.history[e.symbolName]||[],this.history[e.symbolName].push(e);var t=this.history[e.symbolName].length;t>this.historyLimit&&this.history[e.symbolName].splice(0,t-this.historyLimit)}},{key:"getQuote",value:function(e){if(this.history.hasOwnProperty(e))return this.history[e][this.history[e].length-1]}},{key:"getQuoteHistory",value:function(e){return this.history.hasOwnProperty(e)?this.history[e]:[]}},{key:"addQuoteListener",value:function(e,t){this.getEventManager().addListener(e,t)}},{key:"detachQuoteListener",value:function(e,t){this.getEventManager().removeListener(e,t)}},{key:"requestQuoteHistory",value:function(e){this.wsClient.send({type:"requestQuoteHistory",symbolName:e,length:this.historyLimit})}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}(),Calculator=function(){var e;function t(){if(!(this instanceof t))throw TypeError("Cannot call a class as a function")}return e=[{key:"getSpread",value:function(e,t){return Math.pow(10,t)*(e.ask-e.bid)}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}();document.addEventListener("DOMContentLoaded",function(){var e=document.querySelector(".js-asset-options");if(e){var t=JSON.parse(e.getAttribute("data-options")),n=new Calculator,r=new Quotes(new Client(t.wsUrl,t.tradeActive));Array.from(document.querySelectorAll(".js-asset")).forEach(function(e){var t=JSON.parse(e.getAttribute("data-options")),i=e.querySelector(".js-asset-spread"),s=e.querySelector(".js-asset-ask"),o=e.querySelector(".js-asset-bid"),a=t.pipPosition,u=t.digits;r.addQuoteListener(t.symbol,function(e){var t=n.getSpread(e,a).toFixed(1),r=e.ask.toFixed(u),l=e.bid.toFixed(u);if(null!==i){var c=i.innerHTML;t!=c&&(i.classList.remove("-up"),i.classList.remove("-down"),i.classList.add(t>c?"-up":"-down"),i.innerHTML=t)}if(null!==s){var y=s.innerHTML;r!=y&&(s.classList.remove("-up"),s.classList.remove("-down"),s.classList.add(r>y?"-up":"-down"),s.innerHTML=r)}if(null!==o){var h=o.innerHTML;l!=h&&(o.classList.remove("-up"),o.classList.remove("-down"),o.classList.add(l>h?"-up":"-down"),o.innerHTML=l)}})})}});